<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link  href="vendor/mermaid/mermaid.css" rel="stylesheet"/>
    <script src="vendor/mermaid/mermaid.min.js"></script>
    <script src="vendor/jquery/jquery.min.js"></script>
<script>
$(document).ready(function () {
	mermaidAPI.initialize({startOnLoad:false});
	$.ajax({
		method: "GET",
		url:"deps",
		contentType: "application/json; charset=utf-8",
		dataType: "json" /* expecting data type */
	}).done(function (retjson) {
		var graphDef = 'graph LR \n';
		var depgraph = retjson['graph'] || {};
		for (var node in depgraph) {
			var depArr = depgraph[node]['dep'];
			var refJob = depgraph[node]['ref'];
			if (depArr.length == 0 && refJob == undefined) {
				graphDef += node + "\n";
			} else {
				for (var i in depArr) {
					graphDef += node + ' -.-> ' + depArr[i] + "\n";
				}
				if (refJob != undefined) {
					graphDef += node + ' --> ' + refJob + "\n";
				}
			}
		}

		console.log(graphDef);

		mermaidAPI.render('mermsvg', graphDef, function(svg){
			$("#mermaid").html(svg);
			setTimeout(function () {
				var svgs = document.getElementsByTagName("svg");
				var svg = svgs[0];
				svg.setAttribute("height", 1600);
			}, 100);
		});
	});
});
</script>
</head>
<body>
<div id="mermaid" class="mermaid"></div>
</body>
</html>
