[tkblog-up]
exe = echo 'tkblog up'
dep[] = service-blog:searchd-reindex
dep[] = service-blog:tkblog-ready
dep[] = service-blog:blog-sync

[tkblog-ready]
exer = root
exe = echo 'tkblog ready'
dep[] = service-blog:create-db-table
dep[] = service-blog:searchd-init

[create-db-table]
exe = curl "http://localhost/tkblog/panel_.php?init=db"
dep[] = service-blog:mysql-tkblog-user
dep[] = service-blog:tkblog-dir-wr-perm
dep[] = service-blog:tkblog-dir-wr-owner
dep[] = service:php-fpm-perm

[httpd-rootdir-link]
exer = root
exe = ln -sf $MASTER_TREE_PATH/proj/tkblog $HTTPD_ROOT/

[mysql-tkblog-user]
exer = root
exe = $JOBSDIR/mysql-add-tkblog-usr.sh
dep[] = service:mysql-setup

[tkblog-dir-wr-perm]
exer = root
exe = sh -c "find $HTTPD_ROOT/tkblog/blog/ -type d | xargs -I{} chmod 775 {}" && sh -c "find $HTTPD_ROOT/tkblog/blog/ -type f | xargs -I{} chmod 664 {}"
dep[] = service-blog:httpd-rootdir-link

[tkblog-dir-wr-owner]
exer = root
exe = sh -c "find $HTTPD_ROOT/tkblog/blog/ -type d | xargs -I{} chown http:http {}" && sh -c "find $HTTPD_ROOT/tkblog/blog/ -type f | xargs -I{} chown http:http {}"
dep[] = service-blog:httpd-rootdir-link

[searchd-init]
cwd = $MASTER_TREE_PATH/proj/tkblog
exe = ./blog-searchd.sh init

[--searchd-start]
cwd = $MASTER_TREE_PATH/proj/tkblog
exe = ./blog-searchd.sh start
dep[] = service-blog:--searchd-kill

[searchd-reindex]
cwd = $MASTER_TREE_PATH/proj/tkblog
exe = ./blog-searchd.sh reindex
dep[] = service-blog:--searchd-start

[--searchd-kill]
cwd = $MASTER_TREE_PATH/proj/tkblog
exe = ./blog-searchd.sh kill

[blog-sync]
cwd = $MASTER_TREE_PATH/proj/tkblog
exe = ./blog-sync.sh
