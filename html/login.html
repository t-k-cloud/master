<!DOCTYPE html>
<html>
<head>
<script type="text/javascript" src="../vendor/jquery/jquery.min.js"></script>
<script>
$(document).ready(function () {
	$("#login").click(function() {
		$.ajax({
			method: "POST",
			url:"login_auth",
			contentType: "application/json; charset=utf-8",
			dataType: "json" /* expecting data type */,
			data: JSON.stringify({
				username: $("#username").val(),
				password: $("#password").val()
			})
		}).done(function (msg) {
			$("#retjson").text(JSON.stringify(msg, null, 2));
			var token = msg.token || '';
			$("#token").val(token);
		});
	});

	function getNextURL() {
		var parm = window.location.search;
		var m = parm.match(/next=([^&]+)/) || [];
		if (m[1] == undefined)
			return '/';
		else
			return decodeURIComponent(m[1]);
	}

	$("#auth").click(function() {
		window.location.replace('.' + getNextURL());
	});
});
</script>
</head>
<body>
<h3>Login</h3>
<input  id="username" placeholder="user name"/>
<input  id="password" placeholder="password"/>
<button id="login">login</button>

<h3>Auth</h3>
<input  id="token" style="width: 100%; background-color: #e4e4e4"
placeholder="token" readonly/>
<button id="auth">proceed and redirect</button>

<h3>Return JSON</h3>
<span id="retjson" style="color:gray"></span></p>
</body>
</html>
